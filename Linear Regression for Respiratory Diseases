# importing modules and packages
import pandas as pd
import statsmodels.formula.api as smf
import matplotlib.pyplot as plt

# importing data
doc1 = pd.read_excel('Clean_PM 2.5.xlsx', header=0)
doc2 = pd.read_excel('Diseases of the respiratory system.xlsx', header=0)

merged_data = pd.merge(doc1,doc2, on=['Year', 'Voivodeship'])

# Extract the factors X and Y
X = merged_data['Avg_concentration']
Y = merged_data['Respiratory_Diseases']

# Visualize the relationship between X and Y
import matplotlib.pyplot as plt
plt.scatter(X, Y)
plt.xlabel('Avg_concentration')
plt.ylabel('Respiratory_Diseases')
plt.show()

# Initialize an empty list to store the results
results = []

# Iterate through each unique value in the 'Voivodeship' column
for voivodeship in merged_data['Voivodeship'].unique():
    # Filter the DataFrame to only include rows with the current value in the 'Voivodeship' column
    voivodeship_data = merged_data[merged_data['Voivodeship'] == voivodeship]

    # Calculate the correlation coefficient between X and Y for the filtered DataFrame
    corr = voivodeship_data['Avg_concentration'].corr(voivodeship_data['Respiratory_Diseases'])

    # Fit a regression model using OLS (ordinary least squares) on the filtered DataFrame
    result = smf.ols(formula='Respiratory_Diseases ~ Avg_concentration', data=voivodeship_data).fit()

    # Add the correlation coefficient and regression summary to the results list
    results.append((voivodeship, corr))

# Create a DataFrame from the results list
results_df = pd.DataFrame(results, columns=['Voivodeship', 'Correlation'])

# Print the DataFrame
print(results_df)

# Save the DataFrame to a CSV file
results_df.to_excel('output_respiratory.xlsx', index=False)
